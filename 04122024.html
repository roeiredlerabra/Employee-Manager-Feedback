<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>משוב הדדי</title>
    
    <!-- Bootstrap RTL CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css">
    
    <style>
       :root {
    --primary-color: #092052;
    --primary-hover: #1d4ed8;
    --success-color: #059669;
    --warning-color: #d97706;
    --danger-color: #dc2626;
    --text-primary: #1f2937;
    --text-secondary: #4b5563;
    --bg-primary: #f0f2f5;
    --bg-secondary: #ffffff;
}

/* Base Layout */
body {
    min-height: 100vh;
    margin: 0;
    padding: 0;
    background: var(--bg-primary);
    color: var(--text-primary);
    font-family: system-ui, -apple-system, sans-serif;
    display: flex;
    flex-direction: column;
}

/* Header Styles */
.page-header {
    background: linear-gradient(to left, var(--primary-color), var(--primary-hover));
    color: white;
    padding: 0.2rem 0;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.header-content {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 2rem;
    display: flex;
    align-items: center;
    gap: 1rem;
}

.header-logo {
    height: 30px;
    object-fit: contain;
    margin-right: 1rem;
}

/* Main Container Styles */
.main-container {
    flex: 1;
    padding: 2rem 0;
}

.survey-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 2rem;
}

/* Survey Form Sections */
.survey-form-wrapper {
    background: white;
    border-radius: 1rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    overflow: hidden;
}

.category-section {
    margin-bottom: 3rem;
    padding: 2rem;
    background: white;
    border-radius: 1rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.category-title {
    font-size: 1.75rem;
    font-weight: 600;
    color: var(--primary-color);
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid var(--primary-color);
    text-align: center;
}

/* Questions Grid Layout */
.questions-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1.5rem;
    margin-top: 2rem;
}
.progress-bar {
    height: 100%;
    transition: width 0.3s ease-out, background 0.3s ease;
    background: linear-gradient(to right, var(--primary-color), var(--primary-hover));
    border-radius: inherit;
}

.progress {
    height: 0.5rem;
    background: #e5e7eb;
    border-radius: 9999px;
    overflow: hidden;
}
/* Question Cards */
.question-card {
    display: flex;
    flex-direction: column;
    background: #ffffff;
    border: 1px solid #e5e7eb;
    border-radius: 0.75rem;
    padding: 1.25rem;
    transition: all 0.3s ease;
    height: 100%;
}

.question-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.question-title {
    font-size: 1rem;
    font-weight: 500;
    margin-bottom: 1rem;
    color: var(--text-primary);
    flex-grow: 1;
}

/* Rating Scale */
.rating-scale {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-top: 1rem;
}

.rating-option {
    width: 100%;
}

.rating-option label {
    display: flex;
    justify-content: center; /* Center the content horizontally */
    align-items: center; /* Center vertically */
    padding: 0.75rem 1rem;
    background: #f8fafc;
    border-radius: 0.5rem;
    border: 1px solid #e5e7eb;
    transition: all 0.2s ease;
    text-align: center; /* Ensure text is centered */
}

.rating-option label:hover {
    border-color: var(--primary-color);
    background: #f0f7ff;
}

.rating-option input[type="radio"]:checked + div {
    background: var(--primary-color);
    color: white;
    border-radius: 0.375rem;
    padding: 0.5rem;
    width: 100%;
    text-align: center;
}

/* Form Elements */
textarea {
    width: 100%;
    min-height: 120px;
    padding: 1rem;
    border: 1px solid #e5e7eb;
    border-radius: 0.5rem;
    resize: vertical;
    font-size: 1rem;
}

textarea:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

/* Footer */
.page-footer {
    background: #1f2937;
    color: white;
    padding: 1.5rem 0;
    margin-top: auto;
}

.footer-content {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.loading-spinner {
    display: inline-block;
    width: 1.5rem;
    height: 1.5rem;
    border: 2px solid #ffffff;
    border-radius: 50%;
    border-top-color: transparent;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.hidden {
    display: none !important;
}
/* Buttons */
.submit-btn {
    background: #1747af;
    color: white;
    border: none;
    padding: 0.75rem 2rem;
    border-radius: 0.5rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
}

.submit-btn:hover {
    background: var(--primary-hover);
}

.submit-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Utility Classes */
.hidden {
    visibility: hidden;
}

.error {
    border: 2px solid var(--danger-color);
    animation: shake 0.5s;
}

.fixed-message {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
    animation: slideIn 0.3s;
}

/* Animations */
@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(5px); }
    75% { transform: translateX(-5px); }
}

@keyframes slideIn {
    from { transform: translateY(-100%); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

/* Responsive Design */
@media (max-width: 1400px) {
    .questions-grid {
        grid-template-columns: repeat(3, 1fr);
    }
}

@media (max-width: 1024px) {
    .questions-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .questions-grid {
        grid-template-columns: 1fr;
    }
    
    .category-section {
        padding: 1rem;
    }
    
    .header-content,
    .survey-container,
    .footer-content {
        padding: 0 1rem;
    }
    
    .rating-scale {
        flex-direction: column;
    }
    
    .rating-option {
        width: 100%;
    }
}
/* General Container Styling */
.employee-info-header {
    background: linear-gradient(to left, #f8fafc, #f1f5f9);
    border-bottom: 1px solid #e2e8f0;
    padding: 1.5rem;
    direction: rtl; /* Ensures proper RTL alignment */
    text-align: right;
}

/* Grid Layout for Info Sections */
.employee-info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
}

/* Styling for Individual Info Sections */
.info-section {
    background-color: #ffffff;
    padding: 1.25rem;
    border-radius: 0.5rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    transition: box-shadow 0.3s ease, transform 0.3s ease;
}

.info-section:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    transform: translateY(-3px);
}

/* Section Title */
.info-section-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: #1e40af; /* Deep blue accent color */
    margin-bottom: 1rem;
    border-bottom: 3px solid #1e40af;
    padding-bottom: 0.25rem;
}

/* Individual Info Items */
.info-item {
    margin-bottom: 1rem;
    display: flex;
    justify-content: flex-start;
    gap: 0.75rem;
    align-items: center;
}

/* Info Labels */
.info-label {
    font-size: 1rem;
    color: #6b7280; /* Neutral gray text */
    min-width: 120px;
    font-weight: 500;
}

/* Info Values */
.info-value {
    font-size: 1rem;
    color: #374151; /* Darker text color */
    font-weight: 400;
    word-wrap: break-word;
}

/* Add Classy Hover Effects */
.info-value:hover {
    color: #1e40af; /* Matches accent color */
    text-decoration: underline;
}

/* Responsive Adjustments */
@media (max-width: 768px) {
    .employee-info-header {
        padding: 1rem;
    }

    .employee-info-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }

    .info-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.25rem;
    }

    .info-label {
        min-width: auto;
    }
}
    </style>
</head>
<body>
    <!-- Header -->
    <header class="page-header">
        <div class="header-content">
            <!-- Logo -->
            <img src="https://raw.githubusercontent.com/roeiredlerabra/abra-on-boarding/main/img/_master_logo_%D7%90%D7%91%D7%A8%D7%90%20%D7%91%D7%9C%D7%91%D7%9F.gif" alt="Company Logo" class="header-logo">
    
            <!-- Text Content and Progress Bar -->
            <div class="flex flex-col items-start">
                <h1 class="text-2xl font-bold">משוב הדדי</h1>
                <div class="text-sm opacity-90">
                    תקופת הערכה: <span id="evaluationPeriod"></span>
                </div>
            </div>
    
            <!-- Progress Bar -->
            <div class="progress" style="width: 200px">
                <div class="progress-bar" role="progressbar"></div>
            </div>
        </div>
    </header>
    
    

    <!-- Main Content -->
    <div class="main-container">
        <div class="survey-container">
            <div class="survey-form-wrapper">
                <!-- Employee Info -->
                <div class="employee-info-header">
                    <div class="employee-info-grid">
                        <div class="info-section">
                            <h3 class="info-section-title">פרטי עובד</h3>
                            <div class="info-item">
                                <span class="info-label">שם העובד/ת</span>
                                <span class="info-value" id="employeeName"></span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">מחלקה</span>
                                <span class="info-value" id="employeeDepartment"></span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">דואר אלקטרוני</span>
                                <span class="info-value" id="employeeEmail"></span>
                            </div>
                            <div class="info-row">
                                <div class="info-item">
                                    <span class="info-label">תאריך תחילת עבודה</span>
                                    <span class="info-value" id="employeeHireDate"></span>
                                    <span class="info-value" id="employeeTenure"></span>
                                </div>
                                
                            
                                
                            </div>
                        </div>
                        

                    

                        <div class="info-section">
                            <h3 class="info-section-title">פרטי מנהל</h3>
                            <div class="info-item">
                                <span class="info-label">שם המנהל/ת</span>
                                <span class="info-value" id="managerName"></span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">מחלקה</span>
                                <span class="info-value" id="managerDepartment"></span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">דואר אלקטרוני</span>
                                <span class="info-value" id="managerEmail"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Survey Form -->
                <form id="evaluationForm">
                    <div id="surveyContent"></div>
                </form>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="page-footer">
        <div class="footer-content">
            <div>
                <div class="text-sm opacity-75">תאריך מילוי</div>
                <div id="submissionDate" class="font-medium"></div>
            </div>
            <button type="submit" class="submit-btn" form="evaluationForm">
                <span class="submit-text">שלח הערכה</span>
                <span class="loading-spinner hidden"></span>
            </button>
        </div>
    </footer>
<!-- Add in <head> -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <!-- Your existing JavaScript code goes here -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>


    <script>
    // Configuration and Constants
    const API_ENDPOINT = 'https://prod-39.westeurope.logic.azure.com:443/workflows/37fef182446d4610b731450f081f43fc/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=2zKGo49JL0waedwDDLfiCsk5S1p4-KMDvehVNazN_DA';
    const SURVEY_CONFIG = {
        paramPrefix: { 
            EMPLOYEE: 'E', 
            MANAGER: 'M' 
        },
        position: { 
            MANAGER: "MANAGER", 
            EMPLOYEE: "EMPLOYEE" 
        },
        ratingScale: {
            4: 'מצטיין',
            3: 'מעל לנדרש',
            2: 'עבודה ע"פ הנדרש',
            1: 'נדרש שיפור',
            0: 'לא רלוונטי לתפקיד'
        }
    };

const categories = {
    'ידע מקצועי': [
        { 
            question: 'בקיאות במוצר – עד כמה העובד מבין לעומק את המוצר, כולל רכיבים טכניים ותפעוליים?',
            type: 'rating',
            roles: [0, 1],
            schema: 'product_knowledge',
            required: true,
            ariaLabel: 'דירוג בקיאות במוצר',
            description: 'הערכת רמת ההבנה והידע במוצר ורכיביו'
        },
        {
            question: 'הכרות עם מתודולוגיות הפרויקט – כיצד העובד מיישם את שיטות העבודה המתודולוגיות בפרויקטים השונים?',
            type: 'rating',
            roles: [0, 1],
            schema: 'methodology_knowledge',
            required: true,
            ariaLabel: 'דירוג הכרות עם מתודולוגיות',
            description: 'הערכת יישום שיטות העבודה בפרויקטים'
        },
        {
            question: 'הכרות מקצועית עם סביבת הלקוחות – עד כמה העובד מבין את הצרכים העסקיים של הלקוחות ומתאים את הפתרונות בהתאם?',
            type: 'rating',
            roles: [0, 1],
            schema: 'client_environment_knowledge',
            required: true,
            ariaLabel: 'דירוג הכרות עם סביבת לקוחות',
            description: 'הערכת הבנת צרכי הלקוח והתאמת פתרונות'
        },
        {
            question: 'זיהוי הזדמנויות אצל הלקוח – האם העובד מזהה אפשרויות להרחבת פתרונות ושירותים קיימים?',
            type: 'rating',
            roles: [0, 1],
            schema: 'client_opportunities',
            required: false,
            ariaLabel: 'דירוג זיהוי הזדמנויות',
            description: 'הערכת יכולת זיהוי הזדמנויות עסקיות'
        },
        {
            question: 'השתתפות בוובינרים / העשרות מקצועיות – כיצד העובד משתתף בלמידה והעשרה מתמשכת?',
            type: 'rating',
            roles: [0, 1],
            schema: 'professional_development',
            required: false,
            ariaLabel: 'דירוג השתתפות בהעשרה מקצועית',
            description: 'הערכת מעורבות בפעילויות למידה והתפתחות'
        },
        {
            question: 'הכרות עם מוצרים משלימים – עד כמה העובד מכיר מוצרים רלוונטיים נוספים?',
            type: 'rating',
            roles: [0, 1],
            schema: 'complementary_products',
            required: false,
            ariaLabel: 'דירוג הכרות עם מוצרים משלימים',
            description: 'הערכת ידע במוצרים משלימים ורלוונטיים'
        }
    ],
    'מיומנויות עבודה': [
        {
            question: 'יכולת ניהול עצמי – האם העובד מצליח לעבוד בצורה עצמאית תוך ייזום פתרונות?',
            type: 'rating',
            roles: [0, 1],
            schema: 'self_management',
            required: true,
            ariaLabel: 'דירוג יכולת ניהול עצמי',
            description: 'הערכת יכולת עבודה עצמאית וייזום'
        },
        {
            question: 'יכולת עבודה תחת לחץ – כיצד העובד מתמודד עם משימות דחופות או תחת עומס?',
            type: 'rating',
            roles: [0, 1],
            schema: 'pressure_handling',
            required: true,
            ariaLabel: 'דירוג עבודה תחת לחץ',
            description: 'הערכת התמודדות עם מצבי לחץ ועומס'
        },
        {
            question: 'אחריות מקצועית – האם העובד לוקח אחריות מלאה על המשימות שלו?',
            type: 'rating',
            roles: [0, 1],
            schema: 'professional_responsibility',
            required: true,
            ariaLabel: 'דירוג אחריות מקצועית',
            description: 'הערכת רמת האחריות והמחויבות למשימות'
        },
        {
            question: 'שיתוף פעולה ועבודת צוות – באיזו מידה העובד משתף פעולה ומכבד דעות שונות בצוות?',
            type: 'rating',
            roles: [0, 1],
            schema: 'team_collaboration',
            required: true,
            ariaLabel: 'דירוג שיתוף פעולה',
            description: 'הערכת יכולת עבודה בצוות ושיתוף פעולה'
        },
        {
            question: 'הקפדה על נהלים – באיזו מידה העובד מקפיד על נהלי העבודה?',
            type: 'rating',
            roles: [0, 1],
            schema: 'procedure_adherence',
            required: true,
            ariaLabel: 'דירוג הקפדה על נהלים',
            description: 'הערכת מידת ההקפדה על נהלי העבודה'
        },
        {
            question: 'תקשורת אפקטיבית – כיצד העובד מנהל תקשורת עם צוותים אחרים?',
            type: 'rating',
            roles: [0, 1],
            schema: 'effective_communication',
            required: true,
            ariaLabel: 'דירוג תקשורת אפקטיבית',
            description: 'הערכת יכולת תקשורת עם צוותים שונים'
        }
    ],
    'גישה ומוטיבציה': [
        {
            question: 'מעורבות חברתית – עד כמה העובד תורם לאווירה החברתית והמקצועית בצוות?',
            type: 'rating',
            roles: [0, 1],
            schema: 'social_involvement',
            required: false,
            ariaLabel: 'דירוג מעורבות חברתית',
            description: 'הערכת תרומה לאווירה החברתית בצוות'
        },
        {
            question: 'קבלת ביקורת – כיצד העובד מתמודד עם ביקורות ומשובים?',
            type: 'rating',
            roles: [0, 1],
            schema: 'feedback_reception',
            required: true,
            ariaLabel: 'דירוג קבלת ביקורת',
            description: 'הערכת התמודדות עם משוב וביקורת'
        },
        {
            question: 'מוטיבציה לייעול ושיפור – באיזו מידה העובד מעלה רעיונות חדשים לייעול תהליכים?',
            type: 'rating',
            roles: [0, 1],
            schema: 'improvement_motivation',
            required: false,
            ariaLabel: 'דירוג מוטיבציה לשיפור',
            description: 'הערכת יוזמה לשיפור תהליכים'
        },
        {
            question: 'למידה עצמאית – האם העובד מראה יוזמה ללמידה מתמשכת ללא צורך בהנחיה?',
            type: 'rating',
            roles: [0, 1],
            schema: 'self_learning',
            required: false,
            ariaLabel: 'דירוג למידה עצמאית',
            description: 'הערכת יוזמה ללמידה והתפתחות עצמאית'
        }
    ],
    'סגנון עבודה': [
        {
            question: 'סדר וארגון בעבודה – עד כמה העובד שומר על סביבת עבודה מאורגנת ומסודרת?',
            type: 'rating',
            roles: [0, 1],
            schema: 'work_organization',
            required: true,
            ariaLabel: 'דירוג סדר וארגון',
            description: 'הערכת ארגון וסדר בסביבת העבודה'
        },
        {
            question: 'עמידה בזמנים – באיזו מידה העובד מקפיד על עמידה בלוחות זמנים?',
            type: 'rating',
            roles: [0, 1],
            schema: 'time_management',
            required: true,
            ariaLabel: 'דירוג עמידה בזמנים',
            description: 'הערכת עמידה בלוחות זמנים'
        },
        {
            question: 'ניהול פרויקטים – האם העובד מצליח לנהל פרויקטים תוך שמירה על יעדים ברורים?',
            type: 'rating',
            roles: [0, 1],
            schema: 'project_management',
            required: true,
            ariaLabel: 'דירוג ניהול פרויקטים',
            description: 'הערכת יכולת ניהול פרויקטים ועמידה ביעדים'
        }
    ],
    'מדידה עצמית': [
        {
            question: 'רמת שביעות רצון מהביצועים – כיצד את/ה מדרג את שביעות הרצון הכללית שלך?',
            type: 'rating',
            roles: [0, 1],
            schema: 'performance_satisfaction',
            required: true,
            ariaLabel: 'דירוג שביעות רצון עצמית',
            description: 'הערכת שביעות רצון כללית מביצועים'
        },
        {
            question: 'תחומים לשיפור – אילו תחומים את/ה מזהה שבהם תוכל/י להשתפר?',
            type: 'text',
            roles: [0, 1],
            schema: 'improvement_areas',
            required: true,
            ariaLabel: 'תחומים לשיפור',
            description: 'פירוט תחומים הדורשים שיפור'
        },
        {
            question: 'הישגים בולטים – מהם ההישגים המרכזיים שהשגת בתקופה האחרונה?',
            type: 'text',
            roles: [0, 1],
            schema: 'key_achievements',
            required: true,
            ariaLabel: 'הישגים בולטים',
            description: 'פירוט הישגים משמעותיים בתקופה האחרונה'
        }
    ],
    'מיומנויות ניהוליות': [
        {
            question: 'קבלת החלטות – קבלת החלטות במהירות ובביטחון, תוך הערכה נכונה של המצב',
            type: 'rating',
            roles: [1],
            schema: 'decision_making',
            required: true,
            ariaLabel: 'דירוג קבלת החלטות',
            description: 'הערכת יכולת קבלת החלטות מהירה ומדויקת'
        },
        {
            question: 'ניהול זמן וסדר עדיפויות – ניהול זמן/משימות אפקטיבי של הצוות',
            type: 'rating',
            roles: [1],
            schema: 'time_priority_management',
            required: true,
            ariaLabel: 'דירוג ניהול זמן וסדרי עדיפויות',
            description: 'הערכת יכולת ניהול זמן ותעדוף משימות'
        },
        {
            question: 'גמישות והתאמה לשינויים – יכולת הסתגלות והתמודדות עם שינויים בפרויקטים',
            type: 'rating',
            roles: [1],
            schema: 'change_adaptation',
            required: true,
            ariaLabel: 'דירוג גמישות והסתגלות',
            description: 'הערכת יכולת הסתגלות לשינויים'
        },
        {
            question: 'הצבת יעדים ברורים – באיזו מידה המנהל מציב לעובדיו יעדים ברורים ומדידים?',
            type: 'rating',
            roles: [1],
            schema: 'goal_setting',
            required: true,
            ariaLabel: 'דירוג הצבת יעדים',
            description: 'הערכת יכולת הגדרת יעדים ברורים לצוות'
        },
        {
            question: 'יכולת להניע את העובדים לביצועים מיטביים',
            type: 'rating',
            roles: [1],
            schema: 'team_motivation',
schema: 'team_motivation',
            required: true,
            ariaLabel: 'דירוג הנעת עובדים',
            description: 'הערכת יכולת הנעת העובדים להשגת ביצועים מיטביים'
        },
        {
            question: 'ניצול משאבים – האם המנהל מנצל את המשאבים העומדים לרשותו באופן אפקטיבי?',
            type: 'rating',
            roles: [1],
            schema: 'resource_utilization',
            required: true,
            ariaLabel: 'דירוג ניצול משאבים',
            description: 'הערכת יכולת ניצול יעיל של משאבי הארגון'
        },
        {
            question: 'קידום ופיתוח עובדים – באיזו מידה המנהל מצליח לקדם ולפתח את עובדיו?',
            type: 'rating',
            roles: [1],
            schema: 'employee_development',
            required: true,
            ariaLabel: 'דירוג פיתוח עובדים',
            description: 'הערכת יכולת פיתוח וקידום הצוות'
        },
        {
            question: 'למידה מלקחים – האם המנהל לומד מהצלחות ואי-הצלחות ומיישם את הלקחים?',
            type: 'rating',
            roles: [1],
            schema: 'lessons_learned',
            required: true,
            ariaLabel: 'דירוג למידה מלקחים',
            description: 'הערכת יכולת הפקת לקחים ויישומם'
        },
        {
            question: 'ניהול קונפליקטים – כיצד המנהל מתמודד עם מצבי קונפליקט בצוות?',
            type: 'rating',
            roles: [1],
            schema: 'conflict_management',
            required: true,
            ariaLabel: 'דירוג ניהול קונפליקטים',
            description: 'הערכת יכולת פתרון קונפליקטים וניהול מחלוקות'
        },
        {
            question: 'תכנון אסטרטגי – האם המנהל מפתח ומיישם תכניות אסטרטגיות ארוכות טווח?',
            type: 'rating',
            roles: [1],
            schema: 'strategic_planning',
            required: false,
            ariaLabel: 'דירוג תכנון אסטרטגי',
            description: 'הערכת יכולת תכנון וחשיבה אסטרטגית'
        }
    ],
    'מדדי ביצוע': [
        {
            question: 'עמידה ביעדים – באיזו מידה הושגו היעדים שהוגדרו לתקופה זו?',
            type: 'rating',
            roles: [0, 1],
            schema: 'goals_achievement',
            required: true,
            ariaLabel: 'דירוג עמידה ביעדים',
            description: 'הערכת מידת העמידה ביעדים שהוגדרו'
        },
        {
            question: 'איכות העבודה – מהי רמת הדיוק והאיכות בתוצרי העבודה?',
            type: 'rating',
            roles: [0, 1],
            schema: 'work_quality',
            required: true,
            ariaLabel: 'דירוג איכות עבודה',
            description: 'הערכת איכות ודיוק בביצוע המשימות'
        },
        {
            question: 'יעילות בעבודה – האם העבודה מתבצעת באופן יעיל ואפקטיבי?',
            type: 'rating',
            roles: [0, 1],
            schema: 'work_efficiency',
            required: true,
            ariaLabel: 'דירוג יעילות בעבודה',
            description: 'הערכת יעילות ואפקטיביות בביצוע משימות'
        },
        {
            question: 'תרומה לצוות – מהי מידת התרומה הכוללת לצוות ולארגון?',
            type: 'rating',
            roles: [0, 1],
            schema: 'team_contribution',
            required: true,
            ariaLabel: 'דירוג תרומה לצוות',
            description: 'הערכת התרומה הכוללת לצוות ולארגון'
        }
    ],
    'סיכום והערות': [
        {
            question: 'נקודות חוזק עיקריות – מהן נקודות החוזק המשמעותיות ביותר?',
            type: 'text',
            roles: [0, 1],
            schema: 'main_strengths',
            required: true,
            ariaLabel: 'נקודות חוזק עיקריות',
            description: 'פירוט נקודות החוזק המשמעותיות'
        },
        {
            question: 'תחומים לשיפור – מהם התחומים העיקריים הדורשים שיפור?',
            type: 'text',
            roles: [0, 1],
            schema: 'improvement_needed',
            required: true,
            ariaLabel: 'תחומים לשיפור',
            description: 'פירוט תחומים הדורשים שיפור והתפתחות'
        },
        {
            question: 'יעדים לתקופה הבאה – מהם היעדים המרכזיים לתקופת ההערכה הבאה?',
            type: 'text',
            roles: [0, 1],
            schema: 'future_goals',
            required: true,
            ariaLabel: 'יעדים לתקופה הבאה',
            description: 'הגדרת יעדים לתקופה הבאה'
        },
        {
            question: 'הערות נוספות – האם יש הערות או תובנות נוספות שברצונך לשתף?',
            type: 'text',
            roles: [0, 1],
            schema: 'additional_comments',
            required: false,
            ariaLabel: 'הערות נוספות',
            description: 'מקום להערות ותובנות נוספות'
        }
    ]
};
const isSurveyAlreadyFilled = (surveyData, surveyParams) => {
    if (!surveyData || !surveyParams) return false;
    
    // Access the properties directly as they appear in your API response
    const managerFilled = surveyData.ManagerFilled;
    const employeeFilled = surveyData.EmployeeFilled;
    
    console.log('Checking survey filled status:', {
        position: surveyParams.position,
        managerFilled,
        employeeFilled
    });

    // Check if manager survey is filled
    if (surveyParams.position === 'MANAGER' && managerFilled === "1") {
        return true;
    }
    
    // Check if employee survey is filled
    if (surveyParams.position === 'EMPLOYEE' && employeeFilled === "1") {
        return true;
    }
    
    return false;
};

// Add this function to show the "already filled" message
const showSurveyFilledMessage = (position) => {
    const surveyContent = document.getElementById('surveyContent');
    const footer = document.querySelector('.page-footer');
    
    // Create message element
    const messageDiv = createElement('div', {
        className: 'category-section text-center',
        innerHTML: `
            <div class="alert alert-warning" role="alert">
                <h4 class="alert-heading mb-3 font-bold text-xl">
                    ${position === 'MANAGER' ? 'משוב מנהל כבר מולא' : 'משוב עובד כבר מולא'}
                </h4>
                <p class="mb-0">
                    ${position === 'MANAGER' 
                        ? 'כבר מילאת את המשוב עבור העובד/ת זה. לא ניתן למלא את המשוב פעם נוספת.' 
                        : 'כבר מילאת את המשוב שלך. לא ניתן למלא את המשוב פעם נוספת.'}
                </p>
            </div>
        `
    });

    // Clear existing content and add message
    surveyContent.innerHTML = '';
    surveyContent.appendChild(messageDiv);
    
    // Hide the footer with submit button
    if (footer) {
        footer.style.display = 'none';
    }
};

const populateEmployeeInfo = (data) => {
    if (!data) {
        console.error('No data provided to populateEmployeeInfo');
        return;
    }

    try {
        // Employee details
        if (data.Employee) {
            document.getElementById('employeeName').textContent = data.Employee.DisplayName || '';
            document.getElementById('employeeEmail').textContent = data.Employee.Email || '';
            document.getElementById('employeeDepartment').textContent = data.Employee.Department || '';
        }


// Handle the date
if (data.Working_x0020_Start_x0020_Date) {
    const startDate = new Date(data.Working_x0020_Start_x0020_Date);
    const today = new Date();

    // Format the start date in Hebrew
    document.getElementById('employeeHireDate').textContent = startDate.toLocaleDateString('he-IL');

    // Calculate tenure
    let years = today.getFullYear() - startDate.getFullYear();
    let months = today.getMonth() - startDate.getMonth();
    let days = today.getDate() - startDate.getDate();

    // Adjust for negative days
    if (days < 0) {
        months -= 1;
        const previousMonth = new Date(today.getFullYear(), today.getMonth(), 0);
        days += previousMonth.getDate();
    }

    // Adjust for negative months
    if (months < 0) {
        years -= 1;
        months += 12;
    }

    // Populate the tenure field in Hebrew
    document.getElementById('employeeTenure').textContent = 
        `(${years} שנים, ${months} חודשים, ${days} ימים)`;
}



        // Manager details
        if (data.Manager) {
            document.getElementById('managerName').textContent = data.Manager.DisplayName || '';
            document.getElementById('managerEmail').textContent = data.Manager.Email || '';
            document.getElementById('managerDepartment').textContent = data.Manager.Department || '';
        }

        // Evaluation period
        document.getElementById('evaluationPeriod').textContent = new Date().getFullYear();
        document.getElementById('submissionDate').textContent = new Date().toLocaleDateString('he-IL');

    } catch (error) {
        console.error('Error in populateEmployeeInfo:', error);
    }
};
// DOM Helper Functions
const createElement = (tag, attributes = {}, children = []) => {
    const element = document.createElement(tag);
    Object.entries(attributes).forEach(([key, value]) => {
        if (key === 'className') {
            element.className = value;
        } else if (key === 'innerHTML') {
            element.innerHTML = value;
        } else {
            element.setAttribute(key, value);
        }
    });
    children.forEach(child => element.appendChild(child));
    return element;
};

// Survey Elements Creation
const createQuestionLabel = (questionObj) => {
    return createElement('div', {
        id: `${questionObj.schema}-label`,
        className: 'mb-1',
        innerHTML: `
            <div class="text-lg font-semibold text-gray-700 mb-2">
                ${questionObj.question}
                ${questionObj.required ? '<span class="required-marker">*</span>' : ''}
            </div>

        `
    });
};

const createRatingInput = (questionObj, value, label) => {
    const optionDiv = createElement('div', { 
        className: 'rating-option flex-1' 
    });
    
    const optionLabel = createElement('label', { 
        className: 'w-full h-full flex flex-col items-center p-3 rounded-lg',
        innerHTML: `
            <input type="radio" 
                   name="${questionObj.schema}" 
                   value="${value}"
                   ${questionObj.required ? 'required' : ''}
                   class="hidden"
                   aria-label="${questionObj.ariaLabel} - ${label}"
                   aria-required="${questionObj.required}">
            <div class="text-center rounded-lg px-4 py-2 w-full transition-all duration-200">
                ${label}
            </div>
        `
    });
    
    optionDiv.appendChild(optionLabel);
    return optionDiv;
};

const createTextArea = (questionObj) => {
    return createElement('textarea', {
        className: 'w-full p-3 min-h-[120px] resize-y',
        name: questionObj.schema,
        required: questionObj.required,
        'aria-label': questionObj.ariaLabel,
        'aria-required': questionObj.required,
        placeholder: 'הכנס את תשובתך כאן...'
    });
};

const createRatingQuestion = (questionObj) => {
    const questionDiv = createElement('div', {
        className: 'question-card',
        role: 'group',
        'aria-labelledby': `${questionObj.schema}-label`
    });

    const questionLabel = createQuestionLabel(questionObj);
    const ratingScaleDiv = createElement('div', {
        className: 'rating-scale',
        role: 'radiogroup',
        'aria-describedby': `${questionObj.schema}-description`
    });

    if (questionObj.type === 'rating') {
        Object.entries(SURVEY_CONFIG.ratingScale)
            .reverse()
            .forEach(([value, label]) => {
                ratingScaleDiv.appendChild(createRatingInput(questionObj, value, label));
            });
    } else if (questionObj.type === 'text') {
        ratingScaleDiv.appendChild(createTextArea(questionObj));
    }

    questionDiv.appendChild(questionLabel);
    questionDiv.appendChild(ratingScaleDiv);
    return questionDiv;
};

const updateProgress = () => {
    const questionCards = document.querySelectorAll('.question-card');
    let totalQuestions = 0;
    let answeredQuestions = 0;

    questionCards.forEach(card => {
        const radioGroup = card.querySelector('input[type="radio"]');
        const textarea = card.querySelector('textarea');

        if (radioGroup || textarea) {
            totalQuestions++;

            if (radioGroup) {
                const groupName = radioGroup.getAttribute('name');
                const isAnswered = card.querySelector(`input[name="${groupName}"]:checked`);
                if (isAnswered) {
                    answeredQuestions++;
                }
            } else if (textarea) {
                if (textarea.value.trim()) {
                    answeredQuestions++;
                }
            }
        }
    });

    // Calculate progress
    const progress = totalQuestions > 0 ? (answeredQuestions / totalQuestions) * 100 : 0;
    const progressBar = document.querySelector('.progress-bar');
    
    if (progressBar) {
        progressBar.style.width = `${Math.round(progress)}%`;
        
        // Change color to green when progress is 100%
        if (progress === 100) {
            progressBar.style.background = '#059669'; // Using success-color green
        } else {
            progressBar.style.background = 'linear-gradient(to right, var(--primary-color), var(--primary-hover))'; // Reset to default color
        }
    }
};

// Form Data Management
const collectFormData = (form) => {
    const formData = new FormData(form);
    const surveyParams = getSurveyParams();
    
    const results = {
        surveyId: surveyParams.surveyId,
        role: surveyParams.role,
        position: surveyParams.position,
        timestamp: new Date().toISOString(),
        action: 'submitform',
        answers: {}
    };

    formData.forEach((value, key) => {
        results.answers[key] = value;
    });

    return results;
};



// URL Parameter Handling
const getSurveyParams = () => {
    const urlParams = new URLSearchParams(window.location.search);
    const param = urlParams.get('param');
    
    if (!param) {
        throw new Error('Invalid survey parameters');
    }

    const [id, position] = param.split('-');
    
    return { 
        surveyId: id,
        position
    };
};

// Survey Loading and Initialization
const loadSurvey = (surveyParams, managmentRole) => {
    const surveyContent = document.getElementById('surveyContent');
    surveyContent.innerHTML = '';

    // Convert management role to integer for comparison
    const roleNumber = parseInt(managmentRole);

    Object.entries(categories).forEach(([category, questions]) => {
        // Filter questions based on management role
        const filteredQuestions = questions.filter(q => q.roles.includes(roleNumber));

        // Skip if no questions match the role
        if (filteredQuestions.length === 0) {
            return;
        }

        // Skip managerial section for non-managers
        if (category === 'מיומנויות ניהוליות' && roleNumber === 0) {
            return;
        }

        // Create category section
        const categorySection = createElement('div', {
            className: 'category-section'
        });
        
        const categoryHeader = createElement('h2', {
            className: 'category-title',
            innerHTML: category
        });
        
        const questionsGrid = createElement('div', {
            className: 'questions-grid'
        });

        // Add filtered questions
        filteredQuestions.forEach(q => questionsGrid.appendChild(createRatingQuestion(q)));

        categorySection.appendChild(categoryHeader);
        categorySection.appendChild(questionsGrid);
        surveyContent.appendChild(categorySection);
    });

    updateProgress();
};
// Add this function to your JavaScript
const downloadExcel = () => {
    // Get all form data
    const form = document.getElementById('evaluationForm');
    const formData = new FormData(form);
    const answers = {};
    formData.forEach((value, key) => {
        answers[key] = value;
    });

    // Create worksheet data
    const wsData = [];

    // Add header row
    wsData.push(['קטגוריה', 'שאלה', 'תשובה']);

    // Add employee info
    wsData.push(['פרטי עובד', 'שם', document.getElementById('employeeName').textContent]);
    wsData.push(['פרטי עובד', 'מחלקה', document.getElementById('employeeDepartment').textContent]);
    wsData.push(['פרטי עובד', 'דואר אלקטרוני', document.getElementById('employeeEmail').textContent]);
    wsData.push(['פרטי עובד', 'תאריך תחילת עבודה', document.getElementById('employeeHireDate').textContent]);
    wsData.push([]);  // Empty row for spacing

    // Add survey answers
    Object.entries(categories).forEach(([category, questions]) => {
        questions.forEach(question => {
            const answer = answers[question.schema];
            let displayAnswer = answer;
            
            if (question.type === 'rating' && answer) {
                displayAnswer = SURVEY_CONFIG.ratingScale[answer];
            }

            wsData.push([
                category,
                question.question,
                displayAnswer || ''
            ]);
        });
        wsData.push([]); // Empty row between categories
    });

    // Create workbook
    const wb = XLSX.utils.book_new();
    const ws = XLSX.utils.aoa_to_sheet(wsData);

    // Set RTL and column widths
    ws['!dir'] = 'rtl';
    ws['!cols'] = [
        { wch: 20 },  // Category width
        { wch: 50 },  // Question width
        { wch: 30 }   // Answer width
    ];

    // Add worksheet to workbook
    XLSX.utils.book_append_sheet(wb, ws, "הערכת עובד");

    // Generate filename
    const employeeName = document.getElementById('employeeName').textContent;
    const date = new Date().toLocaleDateString('he-IL').replace(/\./g, '-');
    const filename = `הערכת_עובד_${employeeName}_${date}.xlsx`;

    // Download file
    XLSX.writeFile(wb, filename);
};




// Add this to your HTML before the submit button in the footer
const addDownloadButton = () => {
    const downloadBtn = createElement('button', {
        id: 'downloadExcelBtn',
        className: 'submit-btn',
        type: 'button',
        style: 'display: none; margin-right: 1rem; background: #059669;',
        innerHTML: 'הורדה לאקסל',
        onclick: 'downloadExcel()'
    });
    
    const submitBtn = document.querySelector('.submit-btn');
    submitBtn.parentNode.insertBefore(downloadBtn, submitBtn);
};



// Form Submission
const submitSurvey = async (data) => {
    const response = await fetch(API_ENDPOINT, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    });

    if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
    }

    return response.json();
};

const handleSubmit = async (event) => {
    event.preventDefault();
    
    // Since the button is in the footer, let's search the entire document
    const form = event.target;
    const submitBtn = document.querySelector('button[form="evaluationForm"]');
    
    if (!submitBtn) {
        console.error('Submit button not found');
        alert('שגיאה טכנית בטופס');
        return;
    }
    
    // Create text and spinner elements if they don't exist
    let submitText = submitBtn.querySelector('.submit-text');
    let loadingSpinner = submitBtn.querySelector('.loading-spinner');
    
    if (!submitText) {
        submitText = document.createElement('span');
        submitText.className = 'submit-text';
        submitText.textContent = 'שלח הערכה';
        submitBtn.appendChild(submitText);
    }
    
    if (!loadingSpinner) {
        loadingSpinner = document.createElement('span');
        loadingSpinner.className = 'loading-spinner hidden';
        submitBtn.appendChild(loadingSpinner);
    }
    
    // Validate form before submission
    const isValid = validateForm(form);
    if (!isValid) {
        alert('נא למלא את כל השדות החובה');
        return;
    }

    try {
        submitBtn.disabled = true;
        submitText.style.display = 'none';
        loadingSpinner.classList.remove('hidden');

        if (!confirm('האם אתה בטוח שברצונך לשלוח את ההערכה?')) {
            // Reset button state if user cancels
            submitBtn.disabled = false;
            submitText.style.display = 'block';
            loadingSpinner.classList.add('hidden');
            return;
        }

        const results = collectFormData(form);
        const response = await submitSurvey(results);
        
        showSuccessMessage();
        disableForm(form);
        
        // Show the download button after successful submission
        const downloadBtn = document.getElementById('downloadExcelBtn');
        if (downloadBtn) {
            downloadBtn.style.display = 'block';
        }

    } catch (error) {
        console.error('Error submitting survey:', error);
        showErrorMessage(error.message || 'אירעה שגיאה בשליחת הטופס');
    } finally {
        submitBtn.disabled = false;
        submitText.style.display = 'block';
        loadingSpinner.classList.add('hidden');
    }
};
const fetchSurveyData = async (params) => {
    try {
        console.log('Sending request with params:', params);

        const response = await fetch(`https://prod-39.westeurope.logic.azure.com:443/workflows/37fef182446d4610b731450f081f43fc/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=2zKGo49JL0waedwDDLfiCsk5S1p4-KMDvehVNazN_DA`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                surveyId: params.surveyId,
                role: params.rolePrefix,
                position: params.position,
                action:"getsurveydata"
            })
        });

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        console.log('Received data:', data);

        // Verify data structure
        if (!data || typeof data !== 'object') {
            throw new Error('Invalid data received from server');
        }

        // Return the data directly since it's already in the correct format
        return {
    managment: data.managment || "0",
    Manager: data.Manager || null,
    Employee: data.Employee || null,
    Working_x0020_Start_x0020_Date: data.Working_x0020_Start_x0020_Date || "",
    ManagerFilled: data.ManagerFilled || "0",    // Add this line
    EmployeeFilled: data.EmployeeFilled || "0"   // Add this line
};
    } catch (error) {
        console.error('Error in fetchSurveyData:', error);
        throw error;
    }
};
// Fix 2: Add form validation
const validateForm = (form) => {
    // Get all question cards, not just required fields
    const allQuestionCards = form.querySelectorAll('.question-card');
    let isValid = true;
    let firstErrorElement = null;
    let lastAnsweredIndex = -1;

    // Reset any existing error states
    form.querySelectorAll('.error').forEach(element => {
        element.classList.remove('error');
    });

    // Convert NodeList to Array for easier handling
    const questionCardsArray = Array.from(allQuestionCards);

    // First pass: find the last answered question
    questionCardsArray.forEach((card, index) => {
        const radioInputs = card.querySelectorAll('input[type="radio"]');
        const textArea = card.querySelector('textarea');

        if (radioInputs.length > 0) {
            const isAnswered = Array.from(radioInputs).some(radio => radio.checked);
            if (isAnswered) {
                lastAnsweredIndex = index;
            }
        } else if (textArea && textArea.value.trim()) {
            lastAnsweredIndex = index;
        }
    });

    // Second pass: validate and find first unanswered required question
    questionCardsArray.forEach((card, index) => {
        // Only check questions up to the last answered one
        if (index > lastAnsweredIndex + 1) {
            return;
        }

        const radioInputs = card.querySelectorAll('input[type="radio"]');
        const textArea = card.querySelector('textarea');
        const isRequired = card.querySelector('[required]') !== null;

        if (radioInputs.length > 0) {
            const isAnswered = Array.from(radioInputs).some(radio => radio.checked);
            if (!isAnswered && isRequired) {
                isValid = false;
                card.classList.add('error');
                if (!firstErrorElement) {
                    firstErrorElement = card;
                }
            }
        } else if (textArea) {
            if (isRequired && !textArea.value.trim()) {
                isValid = false;
                card.classList.add('error');
                if (!firstErrorElement) {
                    firstErrorElement = card;
                }
            }
        }
    });

    // Scroll to first error if exists
    if (firstErrorElement) {
        firstErrorElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
        setTimeout(() => {
            document.querySelectorAll('.error').forEach(element => {
                element.classList.remove('error');
            });
        }, 3000);
    }

    // Show/hide download button based on validation
    const downloadBtn = document.getElementById('downloadExcelBtn');
    if (downloadBtn) {
        downloadBtn.style.display = isValid ? 'block' : 'none';
    }

    return isValid;
};

const highlightError = (element) => {
    element.classList.add('error');
    element.scrollIntoView({ behavior: 'smooth', block: 'center' });
    setTimeout(() => element.classList.remove('error'), 3000);
};

const showSuccessMessage = () => {
    const successDiv = createElement('div', {
        className: 'alert alert-success text-center mt-4 fixed-message',
        innerHTML: 'ההערכה נשלחה בהצלחה!'
    });
    
    document.querySelector('.survey-form-wrapper').appendChild(successDiv);
    setTimeout(() => successDiv.remove(), 5000);
};

const showErrorMessage = (message) => {
    const errorDiv = createElement('div', {
        className: 'alert alert-danger text-center mt-4 fixed-message',
        innerHTML: message || 'אירעה שגיאה בשליחת הטופס. אנא נסה שוב.'
    });
    
    document.querySelector('.survey-form-wrapper').appendChild(errorDiv);
    setTimeout(() => errorDiv.remove(), 5000);
};

const disableForm = (form) => {
    form.querySelectorAll('input, textarea').forEach(element => {
        element.disabled = true;
    });
    form.classList.add('form-submitted');
};
// Initialization
const initializeSurvey = async () => {
    try {
        const surveyParams = getSurveyParams();
        console.log('Survey Params:', surveyParams);

        let surveyData;
        try {
            surveyData = await fetchSurveyData(surveyParams);
            console.log('Survey Data:', surveyData);

            if (surveyData) {
                // Populate employee info
                populateEmployeeInfo(surveyData);
                
                // Check if survey is already filled
                const isFilledOut = isSurveyAlreadyFilled(surveyData, surveyParams);
                console.log('Is survey filled out:', isFilledOut);
                
                if (isFilledOut) {
                    showSurveyFilledMessage(surveyParams.position);
                    return; // Exit early if survey is already filled
                }
                
                // Continue with normal survey loading if not filled
                loadSurvey(surveyParams, surveyData.managment);
                addDownloadButton();
                
                const form = document.getElementById('evaluationForm');
                
                form.addEventListener('change', (e) => {
                    updateProgress();
                    validateForm(form);
                    const questionCard = e.target.closest('.question-card');
                    if (questionCard && questionCard.classList.contains('error')) {
                        questionCard.classList.remove('error');
                    }
                });

                form.addEventListener('submit', handleSubmit);
            }
        } catch (error) {
            console.error('Failed to fetch survey data:', error);
            showErrorMessage('אירעה שגיאה בטעינת נתוני הסקר');
        }
    } catch (error) {
        console.error('Error in initializeSurvey:', error);
        showErrorMessage('אירעה שגיאה בטעינת הטופס. אנא נסה לטעון מחדש את העמוד.');
    }
};

// Start everything when DOM is ready
document.addEventListener('DOMContentLoaded', initializeSurvey);
    </script>
</body>
</html>
